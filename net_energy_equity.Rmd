---
title: Net Energy Equity
subtitle: A net energy framework to assess energy poverty for American households
titlerunning: Net Energy Equity
authorrunning: Scheier & Kittner
thanks:
    [Grants or other notes about the article that should go on the front page should be placed here. General acknowledgments should be placed at the end of the article.]
authors:
- name: Eric Scheier
  address: Environment, Ecology, and Energy Program, The University of North Carolina at Chapel Hill
  email: eric@scheier.org
- name: Noah Kittner*
  address: Department of Environmental Sciences and Engineering, The University of North Carolina at Chapel Hill; Department of City and Regional Planning, The University of North Carolina at Chapel Hill
  email: kittner@unc.edu
keywords:
  - energy burden
  - net energy
  - macro-energy systems
bibliography: references.bib
bibstyle: spphys
csl: nature-no-et-al.csl
date: "`r format(Sys.time(), '%Y-%B-%d')`"
output:
  bookdown::pdf_book:
    base_format: rticles::springer_article
keep_tex: true
fig_caption: true
header-includes:
- \usepackage{lineno}
- \linenumbers
---

```{r setup, include=FALSE}
is_final=FALSE
is_preview=TRUE
is_draft=TRUE
set.seed(123)

knitr::opts_chunk$set(comment='##', 
                      collapse=ifelse(is_preview,TRUE,!is_draft),
                      echo=ifelse(is_preview,FALSE,is_draft),
                      eval=TRUE,
                      warning=ifelse(is_preview,FALSE,is_draft),
                      error=ifelse(is_preview,FALSE,is_draft),
                      results=ifelse(is_final,'hide',ifelse(is_preview,'hide','asis')),
                      fig.keep='last',
                      dev='pdf',
                      fig.show='hold',
                      message=ifelse(is_preview,FALSE,is_draft),
                      include=ifelse(is_preview,TRUE,is_draft),
                      tidy=TRUE,
                      cache=TRUE,#FALSE,
                      fig.margin=FALSE,
                      fig.fullwidth=TRUE #FALSE
                      )
```

```{r option-view, include=FALSE}
library(tidyverse)
library(knitr)
library(kableExtra)
kable(knitr::opts_chunk$get() %>% enframe())
```


```{r sources, cache=FALSE}
source("sources.R")
```

```{r parameters}
states <- "all" #c("ca","nc","sc") #
refresh <- FALSE
acs_version <- 2018
# geographic_scope <- "tract" #statecitycounty
```

```{r run-methods, cache=FALSE}
paper_methods(states=states,
              acs_version=acs_version,
              refresh=refresh)
```


```{r load-data}
income_metric <- "AMI" #"AMI" #"fpl15" #
geographic_scope <- "Census Tracts" #statecitycounty

version_text <- as.character(acs_version)
if(acs_version==2016){
  version_text <- "sh"
}

base_file_name <- tolower(paste(income_metric,
                                geographic_scope,
                                version_text,
                                paste(states,collapse="_",sep=""), sep = "_"))

clean_data_ami <- read_csv(paste0("data/very_clean_data_",base_file_name,".csv"), guess_max = Inf)

income_metric <- "FPL"
base_file_name <- tolower(paste(income_metric,
                                geographic_scope,
                                version_text,
                                paste(states,collapse="_",sep=""), sep = "_"))
clean_data_fpl <- read_csv(paste0("data/very_clean_data_",base_file_name,".csv"), guess_max = Inf)

tract_file_name <- paste0("data/",paste(states,collapse="_",sep=""),"_census_tracts.geojson")

census_tracts_shp <- st_read(tract_file_name)
replica_sup <- get_replica_supplemental_dataset()
tract_shp <- st_sf(left_join(census_tracts_shp, replica_sup, by=c("gisjoin")))
```

```{r}
# Things in here should probably be moved further up the data processing pipeline
# clean_data_ami$number_of_units <- as.factor(ifelse(clean_data_ami$min_units > 1, "mf", "sf"))
# clean_data_fpl$number_of_units <- as.factor(ifelse(clean_data_fpl$min_units > 1, "mf", "sf"))
```


```{r poverty-lines, eval=TRUE}


energy_burden_poverty_line <- 0.10

eroi_poverty_line <- eroi_func(g=1,
                               s=energy_burden_poverty_line)

average_energy_cost <- weighted.mean(clean_data_ami$energy_cost, 
                                     clean_data_ami$total_kWh*clean_data_ami$households, 
                                     na.rm = T)/weighted.mean(clean_data_ami$total_kWh,
                                                              clean_data_ami$households,
                                                              na.rm = T)

median_energy_cost <- weighted.median(clean_data_ami$energy_cost, 
                                     clean_data_ami$total_kWh*clean_data_ami$households, 
                                     na.rm = T)/weighted.median(clean_data_ami$total_kWh,
                                                              clean_data_ami$households,
                                                              na.rm = T)
# 12*(clean_data_ami$electricity_spend + 
#       clean_data_ami$gas_spend + 
#       clean_data_ami$other_spend)
# clean_data_ami$total_kWh <- clean_data_ami$gas_kWh + clean_data_ami$electricity_kWh
median_electricity_cost <- weighted.median(clean_data_ami$electricity_spend,
                              clean_data_ami$electricity_kWh*clean_data_ami$households, 
                                     na.rm = T)/weighted.median(clean_data_ami$electricity_kWh,
                                                              clean_data_ami$households,
                                                              na.rm = T)

median_gas_cost <- weighted.median(clean_data_ami$gas_spend, 
                                     clean_data_ami$gas_kWh*clean_data_ami$households, 
                                     na.rm = 
                                    T)/weighted.median(clean_data_ami$gas_kWh,
                                                              clean_data_ami$households,
                                                              na.rm = T)
median_gas_cost_Mcf <- weighted.median(clean_data_ami$gas_spend, 
                                     clean_data_ami$gas_Mcf*clean_data_ami$households, 
                                     na.rm = T)/weighted.median(clean_data_ami$gas_Mcf,
                                                              clean_data_ami$households,
                                                              na.rm = T)


ner_poverty_line_dlrs <- ner_func(g=1,
                                  s=energy_burden_poverty_line)

ner_poverty_line_mean <- ner_func(g=1,
                             s=energy_burden_poverty_line,
                             se=energy_burden_poverty_line/(average_energy_cost))

ner_poverty_line_median <- ner_func(g=1,
                             s=energy_burden_poverty_line,
                             se=median_energy_cost/energy_burden_poverty_line)

ner_poverty_line <- ner_poverty_line_dlrs #ner_poverty_line_median


dear_poverty_line <- dear_func(g=1,
                               s=energy_burden_poverty_line)

ner_dear_poverty_line <- dear_func(g=1+median_energy_cost*ner_poverty_line_median,
                               s=1)


```

```{r figure-parameters}
#chart_title <- "Household Economic Return on Energy Spending"
chart_title <- "Community Net Energy Return"
chart_subtitle <- "Net Earnings per Dollar of Energy Consumed"

group_columns <- NULL#"income_bracket")#in_poverty
                   #"primary_heating_fuel"

metric_name <- "ner" #"energy_burden" #"ner" #"dear" #"eroi"
metric_label <- "$/$"
metric_cutoff_level <- ner_poverty_line
metric_cutoff_label <- "Energy Poverty Line"

upper_quantile_view <- 1.0
lower_quantile_view <- 0.0
```

```{r top_metrics}
group_variable <- NULL# "GEOID" #"state_abbr" #merge_geo_id" #
group_columns <- c(group_variable) #c("gisjoin") #
graph_data <- filter_graph_data(clean_data_ami, group_columns, metric_name)

top_metrics <- grouped_weighted_metrics(graph_data, 
                         group_columns, 
                         metric_name, 
                         metric_cutoff_level, 
                         upper_quantile_view=0.99, 
                         lower_quantile_view=0.00)
# head(top_metrics)
```


```{r grouped_weighted_metrics}
#data$GEOID <- sub('.', '', data$gisjoin)
group_variable <- "geoid"# "GEOID" #"state_abbr" #merge_geo_id" #
group_columns <- c(group_variable) #c("gisjoin") #
graph_data <- filter_graph_data(clean_data_ami, group_columns, metric_name)

gwm <- grouped_weighted_metrics(graph_data, 
                         group_columns, 
                         metric_name, 
                         metric_cutoff_level, 
                         upper_quantile_view=0.75, 
                         lower_quantile_view=0.25)
# head(gwm)
```

```{r eval=TRUE}

fpl_graph_data <- filter_graph_data(clean_data_fpl, group_columns="in_poverty", metric_name)

fpl_top_metrics <- grouped_weighted_metrics(fpl_graph_data, 
                         group_columns="in_poverty", 
                         metric_name, 
                         metric_cutoff_level, 
                         upper_quantile_view=0.99, 
                         lower_quantile_view=0.00)
# should replace this with weighted metrics data
# How many households are below the poverty line in this data?
total_households <- fpl_top_metrics$household_count

number_in_poverty <- fpl_top_metrics$households_below_cutoff

pct_in_poverty <- number_in_poverty / total_households

# number_above_poverty <- sum((data$income_bracket!=poverty_cutoff) * (data$households))

pct_above_poverty <- 1 - pct_in_poverty

in_both_poverty <- pct_in_poverty[2]

in_only_energy_poverty <- pct_in_poverty[1]

energy_poverty_rate <- sum(number_in_poverty) / sum(total_households)
```

---
abstract: |
  Energy poverty in the United States is an issue of increasing prevalence. While large datasets exist to analyze household incomes, expenditures, and energy options for households, few consistent metrics exist to evaluate the energy burden of typical U.S. households. Here, we develop a framework using net energy analysis and socioeconomic data from the American Community Survey to observe systematic energy inequity and create a net energy poverty line in the United States. We find substantial instances of energy poverty in the United States -- `r scales::percent(energy_poverty_rate, accuracy=1)` of households experience energy poverty. While `r scales::percent(in_both_poverty, accuracy=1)` of households below the federal poverty line also face energy poverty, fewer than `r scales::percent(in_only_energy_poverty, accuracy=0.01)` of those above the federal poverty line face this scarcity. We also identify and document further disparities in community net energy return, where energy expenditures in the US disproportionately burden those in the black belt across the Southeastern U.S., Hispanic communities near the U.S.-Mexico border, and Native American lands. Further disparities suggest that for solar, wind, and energy efficiency upgrades to improve socioeconomic mobility, programs must reduce relative energy expenditures through improved conservation measures, efficiency upgrades, and access to distributed renewables. We recommend the United States develop and implement a federal energy poverty line.
---

Energy is becoming increasingly unaffordable for American households. In the United States, energy poverty is now a significant challenge as families struggle to meet monthly bills and live paycheck to paycheck[@bednarRecognitionResponseEnergy2020]. Even with rapid declines in technology costs for cleaner, renewable electricity generation options, many households cannot take advantage of technological innovations and advancements such as low-cost rooftop solar or energy efficiency upgrades that improve air quality, lower greenhouse gas emissions, and increase direct household savings[@castellanosRooftopSolarPhotovoltaic2017]. Rooftop solar may be capital intensive, and although the investments may recoup costs, many times a lack of knowledge and experience act as a barrier to implementation. Similarly, for households living in older buildings, the ability to make improvements to building HVAC systems and efficiency changes may require awareness and resources that are left out from current discussions. 

Universal access to affordable, reliable, and modern energy is one of the core tenets of United Nations Sustainable Development Goal (SDG) 7[@pachauriAdvancingEnergyPoverty2020]. Despite efforts to evaluate and quantify energy poverty, few metrics are well-suited to understand the pervasiveness of energy poverty and systematic challenges that many households in the United States face. Access to useful energy is fundamental to ecosystem prosperity and is considered essential to the health and safety of prosperous human civilizations[@hallEnergyWealthNations2018]. The relationship between prosperity and available energy has been explored extensively at macro[@brandtHowDoesEnergy2017] and micro[@mayerTwoFacesEnergy2014] scales across production and consumption stages of the human socio-ecological system's energy life cycle. 

Different groups across society have different basic energy needs[@raoEnergyRequirementsDecent2019]. However, it is becoming increasingly clear that there are multiple standards in the United States: a growing disparity between wealthier and lower-income households, their difference in basic energy needs and extra energy consumption[@brownLowincomeEnergyAffordability2020]. The cost of meeting basic needs is increasingly becoming unaffordable. While per-unit costs are decreasing in the United States, many households struggle to make utility bill payments[@rossHighCostEnergy2018]. This is not just a poverty issue - many of the households living in poverty also lack access to efficiency upgrades or technology enhancements that could decrease the gap between wealthy and poor households. For instance, although solar electricity has declined in cost dramatically and been heavily incentivised over the 21st century, the upfront capital needed to take advantage of this technology elude lower-income communities. Efficiency upgrades are similarly capital-intensive. Even though low-interest loans may be available for this purpose in some communities, the bureaucracy and institutional inertia hold back a more rapid transition.

The vastness of the modern electric grid eludes affordability for everyday households because of the relationships between the utility companies and the users. The impacts of any energy burdens reach far beyond the scope of primary or secondary energy harvesting and delivery. Furthermore, affordability impacts other desirable qualities such as modernity and cleanliness[@pachauriAdvancingEnergyPoverty2020]. A lack of affordability may make energy virtually inaccessible to potential beneficiaries of the energy system. Even beyond mere affordability, ownership of energy infrastructure matters to nation-states, individuals, and corporate interests alike for reasons of equity and autonomy. Not to mention that the energy system has tremendous effects on human health both in its production and consumption[@gohlkeEstimatingGlobalPublic2011]. Cicala et al. found that stay-at-home policies and other social distancing behaviors implemented in the United States in the spring of 2020 due to the COVID-19 pandemic reduced deaths from transportation and electricity related polution by 25% [@cicalaExpectedHealthEffects]. Similar studies have found that neighboring states absorb 90% of the negative externalities associated with electric vehicle adoption due to the connected structure of the electric grid[@hollandEnvironmentalBenefitsDriving2015] and inefficient allocation of subsidies[@tamayaoRegionalVariabilityUncertainty2015].

Historically, many attempts have been made to assess household prosperity based on energy metrics[@], though few directly with the intent to understand energy inequity across census tracts and in relation to access to cleaner energy alternatives. Most notably, the United States benchmarks its Federal Poverty Level (FPL) to the food requirements of the average household[@coferFamilyFoodPlans1962] and uses the FPL as an eligibility criterion for more than 40 federal programs across ten agencies (in addition to state, charitable, and private enterprises that also do so)[@divisiondcdProgramsThatUse2015]. 

Utilizing such a limited scope of household energy expenditures as food for such a wide array of public policy seems prone to error. The welfare of two households with the same food budget may be drastically different if one prepares the food on modern and efficient electric appliances while the other combusts natural gas in the home, thereby exposing the family members to harmful air pollutants such as particulate matter, NOx, and SOx. By definition, the implications of a limited estimate of poverty stretch used for public policy decisions stretch far beyond direct connections to food. Practitioners have posited that the standard policy of “using the ‘economy food plan’ to determine who can afford to hire an attorney” may be depriving citizens of their basic rights insofar as hiring a lawyer is not the same as purchasing food in almost any respect[@grossTooPoorHire2013]. 

```{r places_of_interest, eval=FALSE}
# remove HI and AK
continental_shp <- tract_shp %>% filter(!(state_abbr %in% c("HI","AK", NA)))
# add utility cutout
# utility_shp <- tract_shp %>% filter(company_na=="")

map_data <- left_join(continental_shp, gwm, by=c("geoid"))

clean_top_metrics <- grouped_weighted_metrics(graph_data %>% 
                                                filter(!(state_abbr %in% c("HI","AK", NA))), 
                         group_columns=NULL, 
                         metric_name, 
                         metric_cutoff_level, 
                         upper_quantile_view=.995, 
                         lower_quantile_view=0.005)
# head(clean_top_metrics)

```

```{r maps_of_interest, eval=FALSE, out.width="100%", fig.cap="Some selections of interesting areas on the map"}
# figure_name <- "choropleth_map"
# figure_file <- paste0("figures/",figure_name,".png")
# if(!file.exists(figure_file) || refresh){
choropleth_chart <- choropleth_map(
    clean_data=map_data,
    group_columns,
    metric_name,
    metric_label,
    metric_cutoff_level,
    metric_cutoff_label,
    upper_quantile_view,
    lower_quantile_view,
    chart_title,
    chart_subtitle,
    weighted_metrics=clean_top_metrics)
  # ggsave(figure_file, plot=choropleth_chart)
# }
choropleth_chart
```

It stands to reason that a household or community’s prosperity will be broadly related to its energy affordability. The lower the energy burden, the more discretionary income is available to the household for other necessary goods and services, for savings and investments that contribute to economic growth and community well-being. Inversely, high energy burdens constrict households’ participation in society, and contribute broadly to poverty. Researchers have found that gender, age, housing age, tenure type, energy inefficiency, education, employment, geography, socioeconomic status, and race/ethnicity are associated with high energy burdens[@drehoblUSLowIncomeEnergy2016].

Even if one were to discount the direct adverse effects for those households experiencing high energy burdens, the societal cost of placing excessive negative pressures on these groups may be high[@]. Unaffordable energy has been shown to be negatively related to social cohesion, climate change responses, and disproportionate environmental impacts on low-income populations and minority groups [@carleyJusticeEquityImplications2020]. These connections could have significant implications for navigating sustainable development and meeting societal goals around decarbonization and energy use.

Conversely, we seem to be at a potential inflection point for the promotion of equitable energy prosperity. Primarily this is due to the rapid cost decline and technological improvements in modular digital components for households (solar photovoltaics, battery storage, light-emitting diodes). The energy system has little history of individual ownership of its assets or competition at the grid edge[@waraCompetitionGridEdge2016]. It is now possible to provide most of the necessary energy services to a household at a lower cost than the existing electric grid by assembling a technology stack with approximately the same size and cost of ownership as a motor vehicle. This opportunity is not available equally to everyone. Lower-income households are at risk of paying more for energy if those ablest to pay the cost of defection from the existing grid do so[@barboseBenefitsCostsUtilityownership2020]. We need to understand the dynamics of energy burden and whether we face an opportunity to alleviate it.

While energy affordability has received attention especially over the past decade, the issue lacks a set of widely accepted metrics that can suitably describe all of these dimensions[@linDoesEnergyPoverty2020a]. Frequently used metrics do not tell the whole story. For instance, the simple proportion of a household’s income spent on energy bills does not capture the underlying monthly cash flow patterns that may stress household budgets. If the household is above an energy poverty line defined by this metric for public policy purposes, the family may not receive critical support. Therefore, stakeholders have limited knowledge of which historical interventions have effectively promoted the energy system's affordability, and a likewise limited ability to design new interventions for this issue and the others linked to it. 

Net energy analysis (NEA) offers potential support to this conundrum through the use of formally defined Energy Return Ratios (ERR's) that articulate the relationship between the energy flows within complex systems. The implications of numerous metrics of systems-scale efficiency and net energy returns have been explored through this lens to date[@brandtGeneralMathematicalFramework2011], and are recommended as a framework for future analysis[@carbajales-daleBetterCurrencyInvesting2014]. In doing so, many of these same authors have come to identify “macro-energy systems,”, a class of systems defined by their scale, complexity, and particular suitability for net energy analysis[@leviMacroEnergySystemsNew2019]. Many papers associated with this macro-energy systems scale examine the net energy dynamics of communities, such as networks of homes connected by a shared electricity grid or geographic boundaries, but do not explore the energy poverty dimensions through this lens. Nevertheless, different communities in the United States are experiencing energy poverty in different ways. Net energy can also be applied as a way to identify energy poverty and increasing household burdens going to energy expenditures, despite a technology-level cost reduction happening that is not necessarily accruing to everyday consumers. Here, we examine the relationship between energy spending and household income in America, with particular emphasis on how disparate household net energy ratios signal economic disparities across communities, racial and ethnic groups, and levels of income. This foundational analysis will fill a gap in the current discussion over energy equity by providing a biophysical framework to evaluate the disparities among household net energy outcomes.

Energy poverty is not just a lack of money to meet basic energy needs - it is a lack of the capability to enable a sustainable and prosperous society.

```{r continental}
# remove HI and AK
continental_shp <- tract_shp %>% filter(!(state_abbr %in% c("HI","AK", NA)))
# add utility cutout
# utility_shp <- tract_shp %>% filter(company_na=="")

map_data <- left_join(continental_shp, gwm, by=c("geoid"))

clean_top_metrics <- grouped_weighted_metrics(graph_data %>% 
                                                filter(!(state_abbr %in% c("HI","AK", NA))), 
                         group_columns=NULL, 
                         metric_name, 
                         metric_cutoff_level, 
                         upper_quantile_view=.995, 
                         lower_quantile_view=0.005)
# head(clean_top_metrics)

```



```{r continental-map, fig.cap="Map of the median net earned income per secondary energy expenditure for each census tract in the continental United States. Shades of yellow and red indicate communities at or below the energy poverty line as defined by spending 10% or more of household income on secondary energy (NER<=9)."}
# figure_name <- "choropleth_map"
# figure_file <- paste0("figures/",figure_name,".png")
# if(!file.exists(figure_file) || refresh){
choropleth_chart <- choropleth_map(
    clean_data=map_data,
    group_columns,
    metric_name,
    metric_label,
    metric_cutoff_level,
    metric_cutoff_label,
    upper_quantile_view,
    lower_quantile_view,
    chart_title,
    chart_subtitle=NULL,
    weighted_metrics=clean_top_metrics)
  # ggsave(figure_file, plot=choropleth_chart)
# }
choropleth_chart
```



# Home Net Energy Economics

Net energy refers to the newly released potential to do work as a result of some external activity. Previous studies estimate the net energy return (NER) of a process as a relationship between the gross amount of resource extracted and the amount of resource spent in the extraction process[@brandtCalculatingSystemsscaleEnergy2013]: 

\[
G = Gross\ Resource\ Extracted
\]

\[
S = Spending\ on\ Extraction\ Process
\]

\[
Net\ Energy\ Return\ (NER) = \frac{G - S}{S}
\]


For households extracting income from the economy, these ratios can be composed of:

\[
G_{income} = Gross\ Income
\]

\[
S_{energy} = Spending\ on\ Energy
\]


From these metrics we can create a version of net energy return for households:

\[
NER_{household} = \frac{G_{income} - S_{energy}}{S_{energy}}
\]

This metric represents the net earnings a household receives for every expenditure on secondary energy.

## Developing New Metrics

From these metrics we can create all of the relevant energy ratios [these should be renamed to reflect the vocabulary of [@brandtGeneralMathematicalFramework2011]]:

+ Energy burden is the proportion of income spent on energy:

\[
Energy\ Burden = \frac{S_{energy}}{G_{income}}
\]

+ Energy Return on Investment (EROI) is the inverse of Energy Burden:
\[
EROI = \frac{G_{income}}{S_{energy}}
\]
\[
EROI = (Energy\ Burden)^{-1}
\]


+ Net Energy Ratio (or Net Energy Return) (NER) prevents the double counting of energy expenditures found in Energy Burden:
\[
NER = \frac{G_{income}-S_{energy}}{S_{energy}}
\]

+ Discretionary Energy Availability Rate (DEAR) identifies what proportion of household income remains after energy bills have been paid: 
\[
DEAR = \frac{G_{income}-S_{energy}}{G_{income}}
\]
\[
DEAR = 1 - Energy\ Burden
\]


Of the above metrics, the Net Energy Return (NER) and Discretionary Energy Availability Rate (DEAR) are the most desirable for our assessment. The DEAR is nicely bound between 0-100%, while the NER is the standard metric of Net Energy Analysis because it aligns with physical reality. EROI is a precursor of NER which has been replaced due to the increased focus on "net" rather than "gross" energy returns. Energy Burden is the metric du jour in the energy insecurity literature, which most of the references in the introduction are based on.

Of these metrics we will primarily examine the Net Energy Return, as it is the primary indicator in the study of macro-energy systems like the U.S. residential housing stock. Other proposed indicators of energy poverty may be similarly examined in this manner. While all of the aforementioned ratios are hyperbolic parabaloids, NER has several useful mathematical properties in that it can smoothly handle systems with:
- negative incomes and energy costs
- zero energy cost
- zero income
- extreme values

For the discussion of household energy poverty we are primarily interested in how households of different characteristics are distributed according to their Net Energy Returns, which represents how many net dollars are earned by a household for every dollar they spend on energy. In this context we will refer to NER as the Community Net Energy Return due to the community-wide scope of the results.


## Application to energy poverty

Energy burden can be portrayed in net energy terms [rephrase equations in terms of the variable names used above]:

\[
return_{energy,net} = \frac{income_{gross}-spending_{energy}}{spending_{energy}} = \frac{income_{net_{energy}}}{spending_{energy}}
\]

Energy poverty is commonly defined as an expenditure of greater than 10% of household income on energy[@bednarRecognitionResponseEnergy2020]:

\[
burden_{energy}^{*} = \frac{spending_{energy}}{income_{gross}} > 10%
\] 

. This level will be referred to as the “Energy Poverty Line.” Translated into its relative level for net energy return, the energy poverty line ner* is defined as:

\[
return_{energy_{net}}^{*} = \frac{income_{gross}-spending_{energy}}{spending_{energy}} 
s.t. \frac{spending_{energy}}{income_{gross}} > 10\%
\]
\[
return_{energy_{net}}^{*} = 9.0
\]

This means that a household which earns fewer than 9 dollars for every dollar it spends on secondary energy will be considered to be in energy poverty by the traditional energy burden accounting method. Since the NER is unitless but has this intuitive meaning, we present it below without units. We examine the net energy return at a community scale across the United States below.

```{r}
# violin plot of all of the states with all (4?) scaled metrics and compared (from ML project)
```


# The Household Net Energy Landscape



```{r}
clean_data_fpl$simplified_primary_heating_fuel <- as.factor(ifelse(clean_data_fpl$primary_heating_fuel=="ELECTRICITY",
                                                              "Electricity", 
                                                               ifelse(clean_data_fpl$primary_heating_fuel %in% 
                                                                        c("UTILITY GAS","BOTTLED GAS"),
                                                                      "Gas",
                                                    ifelse(clean_data_fpl$primary_heating_fuel=="SOLAR",
                                                           "Solar",
                                                                      "Other"))))


clean_data_ami$all <- as.factor("all")

clean_data_ami <- left_join(clean_data_ami, replica_sup[c("geoid","company_ty","locale")], by=c("geoid"))

clean_data_ami$simplified_company_type <- ifelse(clean_data_ami$company_ty %in% c("Coop","DistCoop"),
                                                 "Cooperative",
                                                 ifelse(clean_data_ami$company_ty %in% c("Federal",
                                                                                         "Muni",
                                                                                         "State"),
                                                        "Government",
                                                        ifelse(clean_data_ami$company_ty %in% 
                                                                 c("Private","PSubdiv"),
                                                               "Private Capital",
                                                               ifelse(clean_data_ami$company_ty=="IOU",
                                                                      "Public Capital",
                                                                      "Other")
                                                               )
                                                        ))

clean_data_ami$simplified_locale <- sub(" .*", "", clean_data_ami$locale)
```

```{r eval=FALSE}
chart_groups <- list(c(NULL),
                     federal poverty line
                     fuel type?
                       rent+mf
- utility types
- locale types
                  )
```


```{r cache=FALSE}
top_line_group <- NULL

# top_line_charts <- make_all_charts(clean_data_ami,
#                             group_columns=top_line_group,
#                             metric_name,
#                             metric_label, 
#                             metric_cutoff_level,
#                             metric_cutoff_label,
#                             #upper_quantile_view,
#                             #lower_quantile_view,
#                             chart_title=chart_title,
#                             chart_subtitle=chart_subtitle)

top_line_charts <-   density_chart(graph_data, 
                                 metric_name, 
                                 metric_label=NULL, 
                                 group_columns=top_line_group, 
                                 metric_cutoff_level, 
                                 metric_cutoff_label, 
                                 chart_title=NULL, 
                                 chart_subtitle=NULL,
                                 x_label=NULL)
p1=top_line_charts
```

```{r cache=FALSE}
top_line_group <- "income_bracket"

top_line_charts <- make_all_charts(clean_data_fpl,
                            group_columns=top_line_group,
                            metric_name,
                            metric_label=NULL, 
                            metric_cutoff_level,
                            metric_cutoff_label=NULL,
                            #upper_quantile_view,
                            #lower_quantile_view,
                            chart_title=NULL,
                            chart_subtitle=NULL,
                            x_label=NULL)
p2=top_line_charts[["density"]]
```

```{r cache=FALSE}
top_line_group <- c("simplified_primary_heating_fuel")

top_line_charts <- make_all_charts(clean_data_fpl,
                            group_columns=top_line_group,
                            metric_name,
                            metric_label=NULL, 
                            metric_cutoff_level,
                            metric_cutoff_label=NULL,
                            #upper_quantile_view,
                            #lower_quantile_view,
                            chart_title=NULL,
                            chart_subtitle=NULL,
                            x_label=NULL)
p3=top_line_charts[["density"]]
```


```{r cache=FALSE}
top_line_group <- c("number_of_units", "housing_tenure")
# c("number_of_units", "occupancy_type"),
#                           c("occupancy_type", "income_bracket"),
#                           c("number_of_units", "occupancy_type", "income_bracket"),

top_line_charts <- make_all_charts(clean_data_ami,
                            group_columns=top_line_group,
                            metric_name,
                            metric_label=NULL, 
                            metric_cutoff_level,
                            metric_cutoff_label=NULL,
                            #upper_quantile_view,
                            #lower_quantile_view,
                            chart_title=NULL,
                            chart_subtitle=NULL,
                            x_label=NULL)
p4=top_line_charts[["density"]]
```

```{r cache=FALSE}
top_line_group <- c("simplified_company_type")

top_line_charts <- make_all_charts(clean_data_ami,
                            group_columns=top_line_group,
                            metric_name,
                            metric_label=NULL, 
                            metric_cutoff_level,
                            metric_cutoff_label=NULL,
                            #upper_quantile_view,
                            #lower_quantile_view,
                            chart_title=NULL,
                            chart_subtitle=NULL,
                            x_label=NULL)
p5=top_line_charts[["density"]]
```


```{r cache=FALSE}
top_line_group <- c("simplified_locale")

top_line_charts <- make_all_charts(clean_data_ami,
                            group_columns=top_line_group,
                            metric_name,
                            metric_label=NULL, 
                            metric_cutoff_level,
                            metric_cutoff_label=NULL,
                            #upper_quantile_view,
                            #lower_quantile_view,
                            chart_title=NULL,
                            chart_subtitle=NULL,
                            x_label=NULL)
p6=top_line_charts[["density"]]
```



```{r density-charts, cache=FALSE, fig.cap="The distribution of net energy returns across different household characteristics."}
grid.arrange(p1,p2,p3,p4,p5,p6, nrow=2,
             # top=chart_title, 
             # subtitle
             bottom="Proportion of Households", 
             left=paste0(str_to_upper(metric_name)," (",metric_label,")"))
```




```{r}
# show some pie / bar charts of the breakdown between fuels
```

The REPLICA and LEAD datasets allow us to estimate the NER for each census tract in the United States. From this high level we can see in [overall distribution figure] that approximately `r scales::percent(energy_poverty_rate, accuracy=1)` of households in the United States are experiencing energy poverty. Displayed geospatially in Figure \@ref(fig:continental-map), it is clear that the Black Belt in the American Southeast is visibly perceptible, indicating that low-NER follows racial lines in areas where inexpensive energy is available and energy burdens are more dependent on housing quality and patterns of consumption than they are dependent on price. Likewise, border populations and immigrant-populated areas in the Southwest have higher burdens, as do Native American lands. The use of heating oil in the Northwest can be seen through the prevelance of low-NER communities in this area, since heating oil is a notably expensive and inefficienct source of heating commonly used in this region. Urban inequity results in lower NER populations not showing up in in many dense or gentrified urban areas such as the San Francisco Bay Area and New York City. A notable exception to this trend is Detroit, in which the pervasiveness of urban energy poverty has been studied extensively and shown to have distinct geographic boundaries. While some of these conclusions are supported by existing evidence and literature, they should be confirmed with a rigorous analysis of this dataset using the NER metric for reasons explained in [section describing metric].

Subsetting by those communities defined by their relationship to the Federal Poverty line provides a stark picture. While `r scales::percent(in_both_poverty, accuracy=1)` of households below the federal poverty line also face energy poverty, fewer than `r scales::percent(in_only_energy_poverty, accuracy=0.01)` of those above the federal poverty line face this scarcity, underscoring the relative burden of energy expenditures as a poverty trap. When we break the group of relatively prosperous households above the poverty line into subsets we find that X of households living at 100-150% of the Federal Poverty Line are experiencing energy poverty. This suggests that energy poverty may be a useful metric for identifying households at risk of other forms of poverty. However, we do find that most households experiencing energy poverty are also suffering from a broader lack of access to resources characterized by income-based poverty. Given that the quality of energy used by low-income households is expected to be of similar inherent usefulness, this stark contrast in net energy return on the households’ energy investments is surprising.

Examining these dynamics by the status of homeownership reveals further disparities. Though renters and homeowners are similarly distributed below the energy poverty line, there appears to be a clear advantage of homeownership from a net energy perspective for most of the population. Only at a relatively high level of return on investment do renters seem to have a net energy advantage, presumably due to these tenants living in relatively new and efficient urban rentals. Tenure matters for more than just equity itself: renters are less likely to be able to take actions to improve their net energy returns due to a lack of property rights to do so as well as misaligned incentives (the principle-agent issue). Even when action is taken to improve the energy efficiency of a rental building, tenants are less likely to see any economic benefits from it.

Households with solar as a primary heating fuel have a higher net energy income ratio than those with other fuel sources, except for households far below the energy poverty line. Why are solar households not receiving the same benefits of their fuel source across the distribution of incomes? This could be due to the low consumption of lower-income households meaning that the potential savings from installing a renewable energy system are lower than for high-income households.

## Equity

```{r eval=FALSE}
weighted_medians <- clean_data %>%
   group_by(housing_tenure) %>% 
   summarise(median_electricity_spend = if( sum(!is.na(households))<3 ){NA} else { weighted.median(electricity_spend, households, na.rm=TRUE)},
             median_eroi = if( sum(!is.na(households))<3 ){NA} else { weighted.median(mean_eroi, households, na.rm=TRUE)},
            median_income = if( sum(!is.na(households))<3 ){NA} else { weighted.median(annual_income, households, na.rm=TRUE)},
            median_electricity_price = if( sum(!is.na(households))<3 ){NA} else { weighted.median(implied_price_kWh, households, na.rm=TRUE)},
            median_electricity_use = if( sum(!is.na(households))<3 ){NA} else { weighted.median(implied_electricity_use, households, na.rm=TRUE)},
            median_energy_burden = if( sum(!is.na(households))<3 ){NA} else { weighted.median(mean_energy_burden, households, na.rm=TRUE)},
            median_energy_cost = if( sum(!is.na(households))<3 ){NA} else { weighted.median(mean_energy_cost, households, na.rm=TRUE)}
            )
```


```{r eval=FALSE}
gwm <- grouped_weighted_metrics(graph_data=graph_data, 
                                  group_columns=group_columns, 
                                  metric_name=metric_name, 
                                  metric_cutoff_level=metric_cutoff_level, 
                                  upper_quantile_view=upper_quantile_view, 
                                  lower_quantile_view=lower_quantile_view)
gwm <- gwm %>% {if(!is.null(group_columns)) unite(., "group_name", all_of(group_columns), remove=FALSE, sep="+", na.rm=FALSE) else (mutate(., group_name="all"))}

mean_eroi <- graph_data %>%
  ggplot(aes_string(x=metric_name, 
             weight="group_household_weights", 
             fill="group_name", 
             color="group_name")) + 
  geom_density(alpha=0.1) + 
  ggtitle("Household Energy Return on Investment By Utility Ownership Type") + 
  scale_x_continuous(labels = scales::unit_format(unit = "x", scale = 1, accuracy = 1),
                     breaks=seq(from=0,to=100,by=10), 
                     minor_breaks=seq(from=0,to=100,by=1),
                     limits=c(0,100), name="Household Energy Return on Investment\n(Income Earned for each Dollar Spent on Energy)") + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 0.05), name="Proportion of Households") + 
  theme_minimal() + 
  theme(legend.justification = c(1, 1), legend.position = c(1, 1), legend.title=element_blank()) + 
  geom_vline(data=gwm, aes(xintercept=metric_median,  color=group_name),
               linetype="solid", size=0.5, alpha=0.75) + 
  geom_vline(xintercept = 10, linetype="dotted", 
                color = "red", size=1.0, alpha=0.75)

mean_eroi + annotate("text", x = 10, y = 0.0075/3, angle = 90, color="red", label = "Energy Poverty Line", 
    vjust = -0.5, parse = FALSE, alpha=0.75) + 
  annotate("text", x = min(weighted_medians$median_eroi), y = 0.005/3, angle = 90, color="gray25", label = "Median", 
    vjust = -0.5, parse = FALSE, alpha=0.75)
```


```{r eval=FALSE}
independent_variable <- "replica_mwh"
electricity_v_eroi_contour_plot <- graph_data %>% 
  ggplot(aes_string(x=independent_variable,
                    y=metric_name,
             weight="group_household_weights", 
             fill="group_name", 
             color="group_name")) +
  stat_density_2d(aes(alpha = ..piece..), geom="polygon", na.rm=TRUE) +
  guides(alpha = FALSE) +
  stat_smooth(method = "lm", fullrange = TRUE) +
  # geom_rug() + 
  scale_x_continuous(name = "Monthly Electricity Cost", 
                     labels = scales::dollar_format(),
                     limits = c(0, 1000), expand = c(0, 0)) + 
  scale_y_continuous(name = "EROI", 
                     labels = scales::unit_format(unit = "x", scale = 1, accuracy = 1),
                     limits = c(0, 100), expand = c(0, 0)) + 
  theme_pubr() + #   theme(plot.margin = margin()) + 
  theme(legend.position = "bottom")
electricity_v_eroi_contour_plot
```


```{r eval=FALSE}
electricity_spend + theme_void() + theme(legend.position = "none") + labs(title = NULL, x=NULL, y=NULL) + 
  ggtitle("Monthly Electricity Cost vs. EROI") + 
  plot_spacer() + 
  electricity_v_eroi_contour_plot + theme(legend.justification = c(1, 1), legend.position = c(1, 1), legend.title=element_blank()) + 
  mean_eroi + coord_flip() + theme_void() + theme(legend.position = "none") + labs(title = NULL, x=NULL, y=NULL) + 
  plot_layout(ncol = 2, nrow = 2, widths = c(4, 1), heights = c(1, 4))
```


```{r eval=FALSE}
# Monthly Electricity Expenditures
electricity_spend <- clean_data %>%
  ggplot(aes(x=electricity_spend, weight=ownership_type_household_weights/3, fill=ownership_type, color=ownership_type)) + 
  geom_density(alpha=0.1) + 
  ggtitle("Household Monthly Electricity Spending By Utility Ownership Type") + 
  scale_x_continuous(labels = scales::dollar_format(), limits=c(0,300), name="Energy Spend",
                     breaks=seq(from=0,to=300,by=50), 
                     minor_breaks=seq(from=0,to=300,by=10)) + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 0.0005), name="Proportion of Households") + 
  theme_minimal() + 
  theme(legend.justification = c(1, 1), legend.position = c(1, 1), legend.title=element_blank()) + 
  geom_vline(data=weighted_medians, aes(xintercept=median_electricity_spend,  color=ownership_type),
               linetype="solid", size=0.5, alpha=0.75)

electricity_spend + annotate("text", x = min(weighted_medians$median_electricity_spend), y = 0.0025/3, angle = 90, color="gray25", label = "Median",vjust = -0.5, parse = FALSE, alpha=0.75)
```



```{r eval=FALSE}
s1 <- scatter_chart(graph_data, 
                          metric_name, 
                          metric_label,
                          group_columns, 
                          metric_cutoff_level, 
                          metric_cutoff_label, 
                          chart_title, 
                          chart_subtitle,
                          independent_variable="group_households")
s1
```


```{r eval=FALSE}
# Compare maps of energy burden vs. solar rooftop potential
```

From an equity perspective, the Gini coefficient of net energy returns among U.S. households is [X]. This means that the net energy returns are distributed [Y] by household compared to a uniform distribution. Even this perspective is limited given that we would expect the productivity of energy usage by each household would be similar, even if the absolute values of energy consumption vary. In other words: there is no reason that net energy returns should differ among households at all.

Net energy returns are different among different groups of households in America. These striking disparities suggest the existence of deeply structural barriers to prosperity in American society, ones which may not be alleviated and may even be exacerbated by electrification and the transition to clean fuels. How can our energy system be operated and improved to provide equitable access? Are there ways that clean electrification can be used to better benefit currently underserved communities?

A sensible prior hypothesis is that everyone experiences the same efficiency from the energy system as measured by return on energy investment. The marginal unit of energy consumed by one household should lead to as much benefit for that household as any other. Differences in absolute outcomes may be related to the quantity of energy investment. However, here we see that system efficiency is different for different households on a relative basis. This difference is often correlated to factors that are out of the households’ control and even those related to persistent social inequalities.

Energy is central to equity and economic prosperity, but the odds are stacked against many people. The energy system appears to be regressive in that costs accrue disproportionately to those of lower-income levels and the most energy-efficient homes belong to wealthier families. As a result, there has been a disparity in how the benefits of the energy transition are accruing among socioeconomic groups [@vaishnavWasItWorthwhile2017], and there is the potential for further division if appropriate policies are not implemented[@cullenwardDynamicallyEstimatingDistributional2016]. This does not have to be the case. A more comprehensive approach to poverty alleviation in the U.S. would also consider the energy situation of each household and the options available to improve its efficiency. Then, it would make those options accessible to the stakeholders who could benefit. 

Instead, a negative feedback loop results: oil/diesel/wood burning is a significant source of air pollution and exacerbates other household costs like healthcare and maintenance. High energy burdens have already been linked to air pollution (grid-wide and locally), and we can connect these directly to the full scope of household prosperity via net energy. Energy is essential to deal with other inequities in society. There must be a way to design a structure that addresses this disparity in a more equitable way. Solar could work and has outcompeted fossil fuels but is not accessible to Low-to-Moderate-Income (LMI) or even Middle-to-High-Income (MHI) segments due to structural issues. Low-interest loan programs, cooperative asset ownership, and a more in-depth examination of the energy system’s underlying regulatory structures could provide paths forward. This metric offers a way to track how the benefits of the energy transition are being accrued.

## Laboratories of democracy

```{r}
group_columns <- c("state_abbr")
# utility type? see chartbook
graph_data <- filter_graph_data(clean_data=clean_data_ami, 
                                group_columns=group_columns, 
                                metric_name=metric_name)
```


```{r state-violin, cache=FALSE, eval=TRUE, fig.cap="A comparison of net energy returns among the United States."}
# [This figure especially is a work in progress]

# violin plot
y <- make_violin_chart(graph_data=graph_data,
                      group_columns=group_columns,
                      metric_name=metric_name,
                      metric_cutoff_level=metric_cutoff_level)
print(y)
```

"a single courageous State may, if its citizens choose, serve as a laboratory; and try novel social and economic experiments without risk to the rest of the country" - U.S. Supreme Court Justice Louis Brandeis

https://en.wikipedia.org/wiki/Laboratories_of_democracy#:~:text=Laboratories%20of%20democracy%20is%20a,in%20New%20State%20Ice%20Co.&text=Because%20there%20are%2050%20semi,directly%20affecting%20the%20entire%20country.

What are the unique and common threads across CO, CA, HI, DC, WA?

How about ME, MS, AL, VT, CT, RI?

Also, how about states such as Connecticut where higher than average electricity prices may pose affordability threats for communities affected by higher prices. But, states such as ME that continue to utilize residential heating energy sources such as oil and fuelwood will suffer not only from lack of efficiency but health impacts.

Poverty rates in AL and MS permeate through the electricity sector. Not only are households falling behind in terms of income, but energy represents a greater share of household expenditures than neighboring states and other parts of the country.

CA and CO are not immune to these problems, but likely represent a greater spread and diversity of energy affordability impacts. Also, advances in clean energy legislation in states such as CA, CO, HI, DC, WA are a common thread, signaling the value of strong decarbonization targets and accompanying policies to ensure electricity affordability for low-income households.

## Beyond balkanized

[Insert depiction of net energy return variation among grids]
```{r eval=FALSE}
group_columns <- c("company_na")
# utility type? see chartbook
graph_data <- filter_graph_data(clean_data=clean_data_ami, 
                                group_columns=group_columns, 
                                metric_name=metric_name)
```


```{r eval=FALSE, fig.cap="A comparison of net energy returns across the United States (this chart continues to have issues regarding the spacing of the y-axis, which are in the roadmap to address prior to submission)."}
# [This figure especially is a work in progress]

# violin plot
y <- make_violin_chart(graph_data=graph_data,
                      group_columns=group_columns,
                      metric_name=metric_name,
                      metric_cutoff_level=metric_cutoff_level)
print(y)
```

“To call the U.S. grid balkanized would insult the Macedonians.” - Marc L. Spitzer, former member of the Federal Energy Regulatory Commission

https://www.nytimes.com/2013/07/13/us/ideas-to-bolster-power-grid-run-up-against-the-systems-many-owners.html

Given the distinction between affordability and cost of supply as outlined in Pachauris et al., we should spend time focusing on how this metric varies among suppliers.

Secondary energy is unique among these residential consumption categories because a single service provider is usually the authority for determining the costs of energy for each of its customers. In vertically integrated energy markets the monopoly utility is the only option available to all consumers. In restructured energy markets, the public utility is designated as the last resort provider for those unable or unwilling to participate in the competitive procurement of energy. In some markets, specialized rates or programs are available for Low and Moderate Income (LMI) consumers, who may have higher energy burdens. We find it notable that more than half of all funding to address high energy burdens in the U.S. is from utility ratepayer-funded bill and energy efficiency assistance [@rossHighCostEnergy2018]. 

In addition to these relatively local measures, the Low Income Home Energy Assistance Program (LIHEAP) and the Weatherization Assistance Program (WAP) seek to address aspects of energy poverty through bill payment assistance and energy efficiency measures. The efficacy of these programs has been mixed in addressing distributional equity in energy burdens and receiving benefits from energy efficiency programs. The COVID-19 pandemic and associated economic downturn may be a critical opportunity to provide relief payments related to energy expenditures and to invest in more efficient residential and commercial energy infrastructure that enables newer and cleaner systems[@RecoveringFastSlow2020a][@chapmanImpactsCOVID19Transitioning2020]. U.S. households are already spending excessive amounts on energy-especially with more families staying at home for longer periods of time-so the ongoing crisis offers an chance to address the lack of infrastructure and employment opportunities with a focus on residential energy burdens[@graffCOVID19AssistanceNeeds2020a].

This relevance especially holds for electricity because it is a commodity delivered via a stationary, centralized grid system. Even in organized markets, local utilities retain control of the transmission and distribution systems. Consumers are price takers with relatively inelastic demand. Changes in the unit price of energy or slight differences in consumption patterns matter more to those with low incomes than those with higher incomes. Furthermore, the current lack of storage infrastructure on the grid and behind each meter means that households are bound to electricity providers for the time of use. The "forward-looking or "reactive" tendencies of these public electric utilities have implications for the energy transition in their jurisdictions and beyond[@wolakFutureElectricityRetailing2020].

# Conclusion

Policymakers have not systematically deployed interventions based on net energy analysis across American households. Creating a federal energy poverty line would be a critical step in identifying families that face large disparities in access to affordable electricity and energy in the United States and would allow for the improvement of programs’ abilities to address energy burdens. A toolkit based on this analysis enables neighborhood-level outreach where energy burdens are highest.  

Furthermore, this type of dataset can identify opportunities where households could achieve the benefits of emerging technologies that have disproportionately benefited wealthy families. We demonstrate that owning a home and consuming solar power is associated with increased income multipliers for energy expenditures. This advantage leads to gains that are not being realized by many neglected or oppressed communities. 

Energy burden also overlaps with health disparities and environmental justice efforts. Households living in more poverty and closer proximity to highly polluted areas must consume more energy to overcome the particulate emissions. There are clear, mutually synergistic, positive reinforcement mechanisms to alleviate health and environmental disparities in air pollution exposure by reducing household energy burdens and improving economic mobility across low-income households. 

Net energy income is holding back socioeconomic mobility in the U.S. Renters of multi-family apartments earn half as much as owners of single-family homes when normalized by energy expenditures. [Add more with demographic data once have queries for this: e.g., Households in communities of color experience energy poverty at ?x the average rate]. The inherent benefits of solar electricity must be accessible to all populations in the United States to promote sustainability, but barriers such as high capital investment, lack of financing, and inability to take advantage of existing business models, continue to hold back communities of color from receiving a similar benefit to white and wealthier households. Net energy metrics exhibit this income multiplier effect and the resulting divide. Designing solar policies to benefit those facing low net energy ratios will improve net energy income ratios substantially and raise households out of energy poverty in the United States. 

However, concerted attention to technology and policy details matter to implement a national scheme. The data demonstrate a need for quantitative methodologies to support equitable energy infrastructure investments. 

# Methods

## Data
To estimate the Net Energy Income Ratio of American households, we primarily utilize the Low Income Energy Affordability Data (LEAD)[@maLowIncomeEnergyAffordability2019] and Rooftop Energy Potential of Low-Income Communities in America (REPLICA)[@sigrinRooftopSolarTechnical2018] datasets, which were assembled by the U.S. Department of Energy to help “stakeholders make data-driven decisions on energy goal setting and program planning by providing them information on low-income household populations and associated energy use characteristics”[@maLowIncomeEnergyAffordability2019]. These datasets encompass estimates of household energy consumption, income, solar generation potential, and demographic characteristic for all states and most territories in the United States at the census tract scale.  

LEAD: The LEAD dataset portrays the average income, electricity expenditures, gas expenditures, and other fuel expenditures for cohorts of households segmented by location (census tract, county, state) and household characteristics (whether the unit is rented or owned, the building’s year of first construction, the number of units in the building, whether the units are attached, and the unit’s primary heating fuel type). The dataset is assembled by applying an iterative proportional fitting (IPF) algorithm to cross-tabulations of household responses from the 2016 5-year American Community Survey (conducted by the U.S. Census Bureau), which provide the samples for each cohort as Public Use Microdata Samples. IPF is a widely used spatial microsimulation method to allocate individuals (i.e., households) to zones (i.e., census tracts and utility service territories) while calibrating each zone's characteristics to known quantities. Using IPF, the microdata samples are then scaled to match aggregate annual values from utility sales and revenues reported in Energy Information Administration forms 861 and 176.  

REPLICA: The REPLICA dataset adds the technical potential of rooftop solar and additional techno-economic variables (e.g., demographics and electricity rates) used in the ultimate analysis[@sigrinRooftopSolarTechnical2018]. The complete list of factors from REPLICA used in the final analysis is available in the appendix. 

[When we utilize the energetic content or emissions implications of energy consumption, we will have to add consideration of that here [@vonwaldAnalyzingCaliforniaFramework2020][@siler-evansMarginalEmissionsFactors2012].] 

## Treatment 
The LEAD data represents the unit’s ownership status (OWNER vs. RENTER) and income bracket as a fraction of Area Median Income (0-30%, 30-60%, 60-80%, 80-100%, or 100%+) or Federal Poverty Level (0-100%, 100-150%, etc.). These categorical variables are saved as factors. Then we create min_units from BLD INDEX. The variable BLD INDEX represents a non-uniformly distributed set of buckets for the range of the number of units in the building, as well as whether single-unit households are attached or detached from neighboring households. We extract the minimum number of units from the range and whether the building is detached. Those households labeled OTHER UNIT are given values of N.A. for this characteristic. Finally, we create Energy Burden Indicators by creating the metrics s & g of which each indicator is composed: 

s = annual expenditures on electricity (ELEP CAL) + natural gas (GASP CAL) + and other fuels (FULP)  

g = the cohort’s average annual income (HINCP) 

The indicator formulas in Section X Home Energy Economics[intralink] are then used to calculate each cohort’s indicator level. Since we are examining homes’ relationships with the energy system, we ignore any homes that do not use energy as denoted by rows where s==0. The estimation procedure used by the DOE results in an estimated number of occupied housing units meeting the subset characteristics (UNITS, renamed as households) and displays the number of American Community Survey responses that contribute to the estimate of energy expenditures (COUNT, renamed as acs_responses). We first remove any categories with fewer than 1 unit represented since this is not physically possible. This results in removing X% of the available rows (gross: X rows of X). This is a total of X housing units or X% of the estimated total X units in the sample. I have separated any cohorts with incomes or energy costs equal to 0 into another dataset for analysis. This represents approximately X% of the housing units and X% of the examined cohorts, so it will be important to make sure that this subset does not contain systematic bias. However, these data are excluded from the current analysis under the assumption that energy costs equal to 0 are not relevant to this analysis. 

We then combine this dataset with the REPLICA dataset. To do so, we must aggregate the income levels of the LEAD dataset to the simpler schema used by REPLICA for summarizing households’ income relative to the area’s median income (AMI):

- 0-30% AMI: Very Low Income
- 30-80% AMI: Low-to-Moderate Income
- `>=80% AMI: Middle-to-High Income

Also, we create an indicator of whether a particular cohort is in income poverty as defined by the relevant standards for its characteristics. For the AMI data, this is defined as being “Very Low Income” or <=30% of AMI. For the Federal Poverty Line (FPL) version of the LEAD dataset, we translate directly from the designation of the income bracket as follows:

- 0-100% FPL: In Poverty
- `>= 100% FPL: Not In Poverty

The REPLICA dataset also simplifies any households with only one unit per building into “Single Family” homes and any households with more than one unit per building as “Multi-family.” Non-stationary and non-traditional homes are not included in the REPLICA analysis. We match these simplifications in the LEAD dataset by aggregating along the number of units:

- 1 Unit: Single-Family
- `>1 Unit: Multi-Family
- Other Unit: N.A. (excluded from analysis)

After simplifying these characteristics in the LEAD Area Median Income data, we merge the AMI dataset with the REPLICA dataset along the census tract, simplified income bracket, simplified number of units, and housing tenure to achieve the primary dataset used in the analysis. 

The FPL dataset The FPL version of the LEAD dataset is not merged with all of the REPLICA data because of incompatibility between the poverty line and area median income bracket definitions. However, demographic data associated with each census tract as a whole can be merged with the FPL dataset. Both AMI and FPL datasets are combined with demographic data from the REPLICA dataset and geospatial shapefiles from the Census to produce the final datasets used in the analysis.

## Considerations
The meaning of the “primary heating fuel” category comes from the answer to this question on the American Community Survey: “Which fuel is used most for heating this house, apartment, or mobile home?” (Source: https://www.census.gov/acs/www/about/why-we-ask-each-question/heating/.) This question’s power to predict energy expenditures or fuel source is unknown. 

Though the REPLICA dataset relies on a different vintage of the LEAD dataset (2016[cite LEAD1]) than this analysis (2018[cite LEAD2]), inferring differences among annual estimates is not meaningful due to the standard error of the data [@LEAD1methods]. A rigorous treatment of these metrics over time is an area for future research.

# Data Availability

- LEAD
- REPLICA
- EIA Gas prices
- TIGER Shapefiles

Link to final cleaned dataset in github.

# Code Availability

The code to fully reproduce this paper is available [here](https://github.com/emergi-foundation/leroi).

# References

::: {#refs}
:::

# Works Not Yet Cited

---
nocite: |
  @*
...

# Software Used

List of R packages used to be entered here automatically

# Acknowledgements

# Author Contributions

# Competing Interests

The authors declare no competing interests.

# Additional Information

# (APPENDIX) Appendix {-} 

# Charts for All Variables

```{r eval=FALSE}
# ---Template / Style Examples After This---
# 
# # Introduction {#intro}
# 
# Your text comes here. Separate text sections with \cite{R-rmarkdown}. 
# 
# # Section title {#sec:1}
# 
# Text with citations by \cite{Galyardt14mmm}.
# 
# # References 1
# 
# 
# 
# ## Subsection title {#sec:2}
# 
# as required. Don't forget to give each section
# and subsection a unique label (see Sect. \ref{sec:1}).
# 
# #### Paragraph headings 
# 
# Use paragraph headings as needed.
# 
# \begin{align}
# a^2+b^2=c^2
# \end{align}
```

```{r, include = FALSE, eval=FALSE}
r_packages_used <- c("rmarkdown", "knitr")
knitr::write_bib(x = r_packages_used, file = "bibliography.bib")
```
